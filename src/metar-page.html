<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">

<dom-module id="metar-page">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      paper-item,
      paper-icon-item {
        color: black;
      }
      paper-progress {
        margin: 0;
        width: 100%
      }
    </style>

    <iron-ajax
      id="metar"
      handle-as="json"
      last-response="{{metar}}"
      debounce-duration="300"
      loading="{{isloading}}"></iron-ajax>

    <div class="card">

      <div class="card-actions">
        <paper-input autocapitalize label="Station ICAO" value="{{station}}"></paper-input>
      </div>

      <template is="dom-if" if="{{metarFound(metar)}}">
        <div class="card-content">
          <paper-item>
            <paper-item-body two-line>
              <div>[[metar.Info.ICAO]] [[metar.Info.Name]]</div>
              <div secondary>[[metar.Info.City]], [[metar.Info.Country]]</div>
            </paper-item-body>
          </paper-item>

          <paper-icon-item>
            <paper-item-body two-line>
              <div>[[metar.Translations.Wind]]</div>
              <div secondary>Winds</div>
            </paper-item-body>
          </paper-icon-item>

          <paper-icon-item>
            <paper-item-body two-line>
              <div>[[metar.Translations.Visibility]]</div>
              <div secondary>Visibility</div>
            </paper-item-body>
          </paper-icon-item>

          <paper-icon-item>
            <paper-item-body two-line>
              <div>[[metar.Translations.Clouds]]</div>
              <div secondary>Clouds</div>
            </paper-item-body>
          </paper-icon-item>

          <paper-icon-item>
            <paper-item-body three-line>
              <div>[[metar.Translations.Temperature]]</div>
              <div>[[metar.Translations.Dewpoint]]</div>
              <div secondary>Temperature and Dewpoint</div>
            </paper-item-body>
          </paper-icon-item>

          <paper-icon-item>
            <paper-item-body two-line>
              <div>[[metar.Altimeter]] [[metar.Units.Altimeter]]</div>
              <div secondary>Altimeter</div>
            </paper-item-body>
          </paper-icon-item>

          <template is="dom-if" if="[[metar.Translations.Other]]">
            <paper-icon-item>
              <paper-item-body two-line>
                <div>[[metar.Translations.Other]]</div>
                <div secondary>Additional Information</div>
              </paper-item-body>
            </paper-icon-item>
          </template>

          <template is="dom-if" if="[[metar.Remarks]]">
            <paper-icon-item>
              <paper-item-body two-line>
                <div>[[metar.Remarks]]</div>
                <div secondary>Remarks</div>
              </paper-item-body>
            </paper-icon-item>
          </template>

          <paper-item>
            <paper-item-body two-line>
              <div>[[getRawReport(metar)]]</div>
              <div secondary>Raw report</div>
            </paper-item-body>
          </paper-item>
        </div>
      </template>
    </div>
  </template>

  <script>
    class MyView1 extends Polymer.Element {
      static get is() { return 'metar-page'; }

      static get properties() {
        return {
          station: {
            type: String,
            // Observer method identified by name
            observer: '_stationChanged'
          }
        }
      }

      metarFound(metar) {
        return (metar && !metar.Error && !this.isLoading);
      }

      // Observer method defined as a class method
      _stationChanged(newValue, oldValue) {
        if (newValue.length == 4) {
          this.$.metar.url = "https://avwx.rest/api/metar/" + newValue + "?options=info,translate";
          this.$.metar.generateRequest();
        }
      }

      getRawReport(metar) {
        return metar['Raw-Report'];
      }
    }

    window.customElements.define(MyView1.is, MyView1);
  </script>
</dom-module>
